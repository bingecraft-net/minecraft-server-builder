#!/usr/bin/env zsh

if [ ! -f server.properties ] ; then
  cp /overrides/server.properties ./
fi

if [ ! -d world ] ; then
  latest="$(ls -t $HOME/backups/*.tar.gz | head -1)"
  if [ "$latest" != "" ] ; then
    tar xf $latest
  fi
fi

if [ ! -f eula.txt ] ; then
  java -jar server.jar
  if grep "You need to agree to the EULA in order to run the server." logs/latest.log > /dev/null ; then
    sed -i 's/eula=false/eula=true/' eula.txt
  else
    echo expected eula notification to be present in latest log
    exit 1
  fi
fi

exec java -jar server.jar
